<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
	xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
	xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SpeakAI.Views.ExerciseDetailPage"
             BackgroundColor="#F5F5F5"
             Title="{Binding Topic.TopicName}">
    <ContentPage.Resources>
        <ResourceDictionary>
        </ResourceDictionary>
    </ContentPage.Resources>
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            <!-- Exercise Content Frame with Shadow -->
            <Frame x:Name="ExerciseFrame" Padding="15" Margin="5"
                   BorderColor="LightGray"
                   BackgroundColor="White"
                   CornerRadius="12"
                   HasShadow="True">
                <VerticalStackLayout Spacing="12">
                    <!-- Question Section -->
                    <Label Text="Question:"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="DarkBlue"
                           Padding="0,5"/>
                    <Label Text="{Binding CurrentExercise.ContentExercises.Question}"
                           FontSize="17"
                           TextColor="Black"
                           Padding="5"/>
                    <!-- Options Section -->
                    <Label Text="Options:"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="DarkBlue"
                           Padding="0,5"/>
                    <ContentView>
                        <ContentView.Triggers>
                            <DataTrigger TargetType="ContentView" Binding="{Binding CurrentExercise.ContentExercises.Type}" Value="true_false">
                                <Setter Property="Content">
                                    <Frame BackgroundColor="#F9F9F9" Padding="12" CornerRadius="10">
                                        <StackLayout>
                                            <RadioButton Content="True"
                             GroupName="Answers"
                             CheckedChanged="_OnCheckedChanged"/>
                                            <RadioButton Content="False"
                             GroupName="Answers"
                             CheckedChanged="_OnCheckedChanged"/>
                                        </StackLayout>
                                    </Frame>
                                </Setter>
                            </DataTrigger>

                            <!-- Multiple Choice -->
                            <DataTrigger TargetType="ContentView" Binding="{Binding CurrentExercise.ContentExercises.Type}" Value="multiple_choice">
                                <Setter Property="Content">
                                    <Frame BackgroundColor="#F9F9F9" Padding="12" CornerRadius="10">
                                        <CollectionView ItemsSource="{Binding CurrentExercise.ContentExercises.Options}">
                                            <CollectionView.ItemTemplate>
                                                <DataTemplate>
                                                    <RadioButton Content="{Binding .}"
                                     GroupName="ExerciseOptions"
                                     FontSize="16"
                                     TextColor="Black"
                                     Margin="5,3,0,3"
                                     BackgroundColor="#E9F1FF" 
                                     BorderColor="#B3D4FC"
                                     IsChecked="{Binding ., Mode=TwoWay}"
                                     CheckedChanged="OnOptionSelected"/>
                                                </DataTemplate>
                                            </CollectionView.ItemTemplate>
                                        </CollectionView>
                                    </Frame>
                                </Setter>
                            </DataTrigger>

                            <!-- Fill in the Blank -->
                            <DataTrigger TargetType="ContentView" Binding="{Binding CurrentExercise.ContentExercises.Type}" Value="fill_in_the_blank">
                                <Setter Property="Content">
                                    <Entry Placeholder="Type your answer here..."
                                           Text="{Binding SelectedAnswer}"
                                           FontSize="16"
                                           TextColor="Black"
                                           BackgroundColor="White"
                                           Margin="5,3,0,3"/>
                                </Setter>
                            </DataTrigger>
                        </ContentView.Triggers>
                    </ContentView>
                    <!-- Show Answer Button -->
                    <Button Text="Show Answer"
                            TextColor="White"
                            BackgroundColor="#388E3C"
                            CornerRadius="8"
                            Command="{Binding ToggleAnswerVisibilityCommand}"
                            Padding="10,5"
                            FontSize="16"
                            HorizontalOptions="Center"/>
                    <!-- Submit Button -->
                    <Button Text="Submit"
        TextColor="White"
        BackgroundColor="#0288D1"
        CornerRadius="8"
        Command="{Binding SubmitAnswerCommand}"
        Padding="10,5"
        FontSize="16"
        HorizontalOptions="Center"/>
                    <!-- Answer Section -->
                    <Frame BackgroundColor="#E8F5E9" Padding="10" CornerRadius="8" IsVisible="{Binding IsAnswerVisible}">
                        <VerticalStackLayout>
                            <Label Text="Correct Answer:"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="DarkGreen"/>
                            <Label Text="{Binding CurrentExercise.ContentExercises.Answer}"
                                   FontSize="17"
                                   TextColor="Green"/>
                        </VerticalStackLayout>
                    </Frame>
                    <!-- Explanation Section -->
                    <Frame BackgroundColor="#E3F2FD" Padding="10" CornerRadius="8" IsVisible="{Binding IsAnswerVisible}">
                        <VerticalStackLayout>
                            <Label Text="Explanation:"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="DarkBlue"/>
                            <Label Text="{Binding CurrentExercise.ContentExercises.Explanation}"
                                   FontSize="16"
                                   TextColor="Black"/>
                        </VerticalStackLayout>
                    </Frame>
                </VerticalStackLayout>
            </Frame>
            <!-- Navigation Buttons -->
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="20">
                <!-- Back Button -->
                <Button Text="Back"
                        Command="{Binding PreviousExerciseCommand}"
                        IsEnabled="{Binding CanGoBack}"
                        BackgroundColor="#1E88E5"
                        TextColor="White"
                        CornerRadius="8"
                        FontSize="16"
                        Padding="10,5"
                        WidthRequest="100"/>
                <!-- Next Button -->
                <Button Text="Next"
                        Command="{Binding NextExerciseCommand}"
                        IsEnabled="{Binding CanGoNext}"
                        BackgroundColor="#43A047"
                        TextColor="White"
                        CornerRadius="8"
                        FontSize="16"
                        Padding="10,5"
                        WidthRequest="100"/>
                <!-- Exit Button -->
                <Button Text="Exit"
                        Command="{Binding ExitCommand}"
                        BackgroundColor="Red"
                        TextColor="White"
                        CornerRadius="8"
                        FontSize="16"
                        Padding="10,5"
                        WidthRequest="100"/>
            </HorizontalStackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
